# Spacer-Seq_Nat-Protocols

We have adapted the scripts pertaining to Bhattarai-Kline et. al 2022, Nature, available on our [GitHub](https://github.com/Shipman-Lab/Spacer-Seq), into this Jupyter notebook. This notebook serves as a self-contained, interactive walkthrough of the deep sequencing data generated during our experiments. The notebook requires `Jupyter-notebook` to be installed; the rest of the dependencies are handled internally within the notebook. Note that the analysis pipeline is meant to be run on a Unix-like operating system; nonetheless, it can be adapted to run on Windows-based OSs with minimal changes to the notebook, which are pointed out herein.

---------- 

## Overview of the analysis pipeline

After quality-based read trimming, the first part of the analysis consists in extracting new spacers found in the sequenced CRISPR arrays, and storing both the new spacer sequences and the sequence of the read containing them. These reads and spacers are binned according to their characteristics, including the number of new spacers per read.       
      
Next, the order of the spacers in each newly-expanded CRISPR array is determined, as well as whether these new spacers are derived from either of the barcoded retron noncoding RNAs (henceforth referred to as “A” and “B” spacers) or not (henceforth referred to as “N” spacers, likely genome- or plasmid-derived).     
      
For a CRISPR array to be informative in terms of inferring the order transcriptional events, it must meet three criteria: (a) the array should contain at least two new spacers, (b) at least one of the spacers should contain a barcoded retron-derived spacer, and (c) at least two spacers must have different identities. Explicitly, the number of $A \to B \to \text{Leader}$, $A \to N \to \text{Leader}$, …, etc. CRISPR arrays are counted and used for the calculation of ordering scores, discussed in more detail below.      
      
Following the count of each spacer ordering possibility, we calculate three ordering scores, which describe and help us infer the ordering of transcriptional events. These scores make an assumption about the biology: $N$ spacers are acquired at a constant rate during the course of the recording experiment. Moreover, this analysis is designed to reconstruct a transcriptional history into two epochs, one early and one late. Further subdivision of the temporal signal would require a substantially more complicated analysis than is provided here.    
     
In cases such as ours where two promoters are under study, the CRISPR arrays are analyzed for order based on three scores, each $\in [-1,1]$: (1) the $A/B$ score, (2) the $A/N$ score, and (3) the $B/N$ score.    
1. **A/B score.** The A/B score determines both the order of and magnitude of temporal separation between the transcriptional events evidenced by the acquisition of spacers $A$ and $B$. Positive scores suggest that transcriptional event $A$ occurred before $B$ and thus more $B$ spacers are found in the Leader-proximal position relative to the number of $A$ spacers; on the other hand, negative scores suggest the opposite, namely that event $B$ occurred before $A$. The magnitude of the score represents the temporal separation between $A$ or $B$, or how much the transcriptional activity between $A$ or $B$ overlaps in time. The more their activity overlaps in time, the closer to zero this score will be.     
2. **A/N score.** The $A/N$ score determines how the timing of $A$ is expressed in comparison to the constant signal $N$, for the duration of the recording experiment. It takes into account the relative frequencies of Leader-distal vs. Leader-adjacent $A$-expanded arrays: a positive score suggests that $A$ is strongly expressed in the first epoch rather than the second, and conversely for a negative score.     
3. **B/N score.** The same interpretations of the $A/N$ score applies here, except in relation to $B$ rather than $A$. However, by definition, $B/N$ takes into account the relative frequencies of Leader-adjacent vs. Leader-proximal $B$-expanded arrays: positive scores suggest that $B$ occurred in the second epoch rather than the first, and conversely for a negative score.
     
Fig. 3b-e in Lear et. al 2022, Nat Protocols provides hypothetical examples of different transcriptional activity for two promoters across two epochs and what scores might be expected in such cases. See also Box 3 in Lear et. al 2022, Nat Protocols for more information about the exact mathematical calculations and interpretation of a given composite score.

------- 

## Handling dependencies
Most of the dependencies can be installed through pip, the package installer for Python. For instance, Jupyter-lab, the web-based interactive development environment for Python notebooks used to run our notebook, can be installed through pip. However, we strongly recommend users, especially those less familiar with wrangling Python environments and package installation, to we recommend you use the [Anaconda Distribution](https://www.anaconda.com/distribution) - it includes Python and many other commonly used packages for scientific computing and data science. Anaconda also enables easy installation and handling of dependencies. In particular, we recommend users start with [Miniconda](https://docs.conda.io/en/latest/miniconda.html), a minimal installer for conda. It is a small version of Anaconda that includes only conda, Python, the packages they depend on, and a small number of other useful packages. However, it allows users to use the conda install command to install effectively any package from the Anaconda repository and its various channels, including the wonderful Bioconda channel.
